<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GradeFlow - حاسبة المعدل الذكية</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #28a745;
            --primary-dark: #218838;
            --primary-light: #34ce57;
            --secondary-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-tertiary: #2d2d2d;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-input: rgba(255, 255, 255, 0.08);
            
            --text-primary: #ffffff;
            --text-secondary: #b8b8d1;
            --text-muted: #8b8ba7;
            
            --border-color: rgba(255, 255, 255, 0.1);
            --border-focus: rgba(40, 167, 69, 0.5);
            --border-success: #28a745;
            --border-danger: #dc3545;
            
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.2);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.3);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .light-mode {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --bg-card: rgba(255, 255, 255, 0.8);
            --bg-input: rgba(255, 255, 255, 0.9);
            
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            
            --border-color: rgba(0, 0, 0, 0.1);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4caf50, #357a38);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: #ffffff;
            box-shadow: 0 4px 8px rgba(46, 125, 50, 0.4);
            user-select: none;
            cursor: default;
        } 

        .brand-text h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .brand-text p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 700;
        }

        .theme-toggle {
            width: 50px;
            height: 50px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: default;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            background: var(--bg-input);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 10px;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
        }

        .nav-tab {
            padding: 15px 20px;
            background: transparent;
            color: var(--text-secondary);
            border: none;
            border-radius: var(--radius-md);
            cursor: default;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-tab svg {
            width: 20px;
            height: 20px;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            transition: var(--transition);
            z-index: -1;
        }

        .nav-tab.active::before,
        .nav-tab:hover::before {
            left: 0;
        }

        .nav-tab.active,
        .nav-tab:hover {
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Calculator Container */
        .calculator-container {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .calculator-container.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 25px;
            text-align: center;
            color: var(--primary-color);
        }

        /* Grade Input Grid */
        .grades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .grade-input-group {
            background: var(--bg-input);
            border-radius: var(--radius-md);
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .grade-input-group.hidden {
            display: none;
        }

        .grade-input-group::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-color);
            transform: scaleX(0);
            transition: var(--transition);
        }

        .grade-input-group:hover::before,
        .grade-input-group:focus-within::before {
            transform: scaleX(1);
        }

        .grade-input-group:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            border-color: var(--border-focus);
        }

        .input-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .grade-input {
            width: 100%;
            padding: 12px 15px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 500;
            text-align: center;
            transition: var(--transition);
        }

        .grade-input:focus {
            outline: none;
            border-color: var(--border-focus);
            background: rgba(40, 167, 69, 0.1);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        .grade-input:disabled {
            background: var(--bg-tertiary);
            color: var(--text-muted);
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Subject Group for Units */
        .subject-group {
            background: var(--bg-input);
            border-radius: var(--radius-md);
            padding: 20px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .subject-group.disabled {
            opacity: 0.5;
            default-events: none;
            background: var(--bg-secondary);
        }

        .subject-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }

        .subject-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .subject-inputs.single {
            grid-template-columns: 1fr;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .input-group input {
            padding: 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            text-align: center;
            transition: var(--transition);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.1);
        }

        .input-group input:disabled {
            background: var(--bg-tertiary);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        /* Language Options */
        .language-options {
            background: var(--bg-input);
            border-radius: var(--radius-md);
            padding: 20px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
        }

        .language-option {
            margin-bottom: 15px;
        }

        .language-option:last-child {
            margin-bottom: 0;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: default;
            margin-bottom: 10px;
        }

        .custom-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            position: relative;
            transition: var(--transition);
        }

        .custom-checkbox input {
            opacity: 0;
            position: absolute;
        }

        .custom-checkbox input:checked + .checkmark {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .checkmark {
            width: 100%;
            height: 100%;
            border-radius: 4px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .checkmark::after {
            content: '✓';
            color: white;
            font-weight: bold;
            opacity: 0;
            transition: var(--transition);
        }

        .custom-checkbox input:checked + .checkmark::after {
            opacity: 1;
        }

        /* Unit Selector */
        .unit-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .unit-option {
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 15px;
            cursor: default;
            transition: var(--transition);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .unit-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            transition: var(--transition);
            z-index: -1;
            opacity: 0.1;
        }

        .unit-option.active::before {
            left: 0;
        }

        .unit-option.active {
            border-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        .unit-option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .unit-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .unit-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Buttons */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: default;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn svg {
            width: 18px;
            height: 18px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--shadow-md);
            width: 100%;
            margin-bottom: 20px;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-success {
            background: var(--primary-color);
            color: white;
            flex: 1;
            border: 1px solid var(--border-success);
        }

        .btn-success:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--secondary-color);
            color: white;
            flex: 1;
            border: 1px solid var(--border-danger);
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        /* Results Section */
        .result-container {
            margin: 30px 0;
        }

        .main-result {
            background: var(--bg-input);
            border-radius: var(--radius-lg);
            padding: 25px;
            text-align: center;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .main-result::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-color);
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .result-label {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Results Table */
        .results-table {
            background: var(--bg-input);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-md);
            display: none;
        }

        .table-header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 20px;
            font-weight: 600;
            text-align: center;
        }

        .table-row {
            padding: 15px 20px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 20px;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .table-row:hover {
            background: rgba(40, 167, 69, 0.05);
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .semester-row {
            background: rgba(40, 167, 69, 0.1);
            font-weight: 600;
        }

        .module-name {
            text-align: right;
            font-weight: 500;
            color: var(--text-primary);
        }

        .table-value {
            text-align: center;
            font-weight: 600;
        }

        /* Year Summary */
        .year-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: var(--bg-input);
            border-radius: var(--radius-lg);
            padding: 25px;
            text-align: center;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-color);
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .summary-title {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        /* Color Classes */
        .text-success { color: var(--primary-color); }
        .text-warning { color: var(--warning-color); }
        .text-danger { color: var(--secondary-color); }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--primary-color);
            color: white;
            padding: 15px 25px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            transform: translateX(400px);
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification svg {
            width: 20px;
            height: 20px;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
            border-top: 1px solid var(--border-color);
            margin-top: 50px;
        }

        .footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
        }

        .footer a:hover {
            opacity: 0.8;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                padding: 15px;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .brand-text h1 {
                font-size: 2rem;
            }

            .nav-tabs {
                grid-template-columns: 1fr;
            }

            .grades-grid {
                grid-template-columns: 1fr;
            }

            .table-header,
            .table-row {
                grid-template-columns: 1.5fr 1fr 1fr 1fr;
                gap: 10px;
                padding: 15px 10px;
                font-size: 0.9rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .year-summary {
                grid-template-columns: 1fr;
            }

            .unit-selector {
                grid-template-columns: 1fr;
            }

            .notification {
                right: 15px;
                left: 15px;
                transform: translateY(100px);
            }

            .notification.show {
                transform: translateY(0);
            }

            .subject-inputs {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Scroll Animations */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: var(--transition);
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Unit form styles */
        .unit-form {
            display: none;
        }
        .unit-form.active {
            display: block;
        }

        /* Unit result details */
        .unit-result-details {
            background: var(--bg-input);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
            display: none;
        }

        .unit-result-details.show {
            display: block;
        }

        .unit-detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .unit-detail-row:last-child {
            border-bottom: none;
            font-weight: 600;
            color: var(--primary-color);
        }

        .unit-detail-label {
            color: var(--text-secondary);
        }

        .unit-detail-value {
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none"
                         stroke="#1B5E20" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                         style="filter: drop-shadow(0 1px 2px rgba(0, 100, 0, 0.5));">
                      <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
                      <line x1="8" y1="6" x2="16" y2="6"></line>
                      <circle cx="8" cy="10" r="0.75"></circle>
                      <circle cx="12" cy="10" r="0.75"></circle>
                      <circle cx="16" cy="10" r="0.75"></circle>
                      <circle cx="8" cy="14" r="0.75"></circle>
                      <circle cx="12" cy="14" r="0.75"></circle>
                      <circle cx="16" cy="14" r="0.75"></circle>
                      <circle cx="8" cy="18" r="0.75"></circle>
                      <circle cx="12" cy="18" r="0.75"></circle>
                      <circle cx="16" cy="18" r="0.75"></circle>
                    </svg>
                </div>
                <div class="brand-text">
                    <p>حاسبة سنة أولى علوم وتكنولوجيا L1 (ST)</p>
                </div>
            </div>
            <button class="theme-toggle" id="themeToggle" aria-label="تبديل السمة">
                <svg class="sun-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="moon-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-target="s1Container">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2z"></path>
                    <path d="M19 7h-4a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"></path>
                </svg>
                الفصل الأول (S1)
            </button>
            <button class="nav-tab" data-target="s2Container">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3v18h18"></path>
                    <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"></path>
                </svg>
                الفصل الثاني (S2)
            </button>
            <button class="nav-tab" data-target="yearContainer">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3v18h18"></path>
                    <path d="M8 17l4-4 4 4"></path>
                    <path d="M12 13V7"></path>
                </svg>
                معدل السنة
            </button>
            <button class="nav-tab" data-target="unitContainer">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                </svg>
                معدل الوحدات
            </button>
        </nav>

        <!-- S1 Calculator -->
        <div id="s1Container" class="calculator-container active">
            <h2 class="section-title">حساب معدل الفصل الأول</h2>
            <form id="s1Form">
                <div class="grades-grid">
                    <div class="grade-input-group">
                        <label class="input-label">MATH (TD)</label>
                        <input type="number" class="grade-input" id="s1_math_td" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">MATH (EXAMEN)</label>
                        <input type="number" class="grade-input" id="s1_math_exam" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">PHYSIC (TD)</label>
                        <input type="number" class="grade-input" id="s1_phys_td" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">PHYSIC (EXAMEN)</label>
                        <input type="number" class="grade-input" id="s1_phys_exam" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">CHIMIE (TD)</label>
                        <input type="number" class="grade-input" id="s1_chem_td" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">CHIMIE (EXAMEN)</label>
                        <input type="number" class="grade-input" id="s1_chem_exam" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">INFO (TP)</label>
                        <input type="number" class="grade-input" id="s1_cs_tp" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">INFO (EXAMEN)</label>
                        <input type="number" class="grade-input" id="s1_cs_exam" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">TP CHIMIE</label>
                        <input type="number" class="grade-input" id="s1_tp_chem" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">TP PHYSIC</label>
                        <input type="number" class="grade-input" id="s1_tp_phys" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">MST</label>
                        <input type="number" class="grade-input" id="s1_mst" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">Éthique et déontologie</label>
                        <input type="number" class="grade-input" id="s1_ethics" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">METHODOLOGY</label>
                        <input type="number" class="grade-input" id="s1_methodology" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">ENGLISH</label>
                        <input type="number" class="grade-input" id="s1_english" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                </div>
                <button type="button" class="btn btn-primary" onclick="calculateS1Average()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <path d="M9 9h6v6H9z"></path>
                    </svg>
                    حساب المعدل
                </button>
            </form>
            
            <div class="result-container">
                <div class="main-result">
                    <div class="result-value" id="s1ResultValue">--</div>
                    <div class="result-label">معدل الفصل الأول</div>
                </div>
                <div class="results-table" id="s1ResultsTable">
                    <div class="table-header">
                        <div>Average</div>
                        <div>الرصيد</div>
                        <div>Coef</div>
                        <div>Module</div>
                    </div>
                    <div id="s1TableContent"></div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-success" onclick="saveData('s1')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17,21 17,13 7,13 7,21"></polyline>
                        <polyline points="7,3 7,8 15,8"></polyline>
                    </svg>
                    حفظ النقاط
                </button>
                <button class="btn btn-danger" onclick="resetData('s1')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="1,4 1,10 7,10"></polyline>
                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                    </svg>
                    إعادة تعيين
                </button>
            </div>
        </div>

        <!-- S2 Calculator -->
        <div id="s2Container" class="calculator-container">
            <h2 class="section-title">حساب معدل الفصل الثاني</h2>
            <form id="s2Form">
                <div class="language-options">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary);">خيارات اللغات الأجنبية:</h3>
                    
                    <div class="language-option">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox">
                                <input type="radio" name="languageOption" id="bothLanguagesRadio" value="both" checked>
                                <div class="checkmark"></div>
                            </div>
                            <label for="bothLanguagesRadio">أدرس لغتين أجنبيتين (إنجليزية + فرنسية) - معامل 1 لكل لغة</label>
                        </div>
                    </div>
                    
                    <div class="language-option">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox">
                                <input type="radio" name="languageOption" id="englishOnlyRadio" value="english">
                                <div class="checkmark"></div>
                            </div>
                            <label for="englishOnlyRadio">أدرس الإنجليزية فقط - معامل 2</label>
                        </div>
                    </div>
                    
                    <div class="language-option">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox">
                                <input type="radio" name="languageOption" id="frenchOnlyRadio" value="french">
                                <div class="checkmark"></div>
                            </div>
                            <label for="frenchOnlyRadio">أدرس الفرنسية فقط - معامل 2</label>
                        </div>
                    </div>
                </div>

                <div class="grades-grid">
                    <div class="grade-input-group">
                        <label class="input-label">MATH (TD)</label>
                        <input type="number" class="grade-input" id="s2_math_td" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">MATH (EXAMEN)</label>
                        <input type="number" class="grade-input" id="s2_math_exam" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">PHYSIC (TD)</label>
                        <input type="number" class="grade-input" id="s2_phys_td" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">PHYSIC (EXAMEN)</label>
                        <input type="number" class="grade-input" id="s2_phys_exam" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">CHIMIE (TD)</label>
                        <input type="number" class="grade-input" id="s2_chem_td" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">CHIMIE (EXAMEN)</label>
                        <input type="number" class="grade-input" id="s2_chem_exam" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">INFO (TP)</label>
                        <input type="number" class="grade-input" id="s2_cs_tp" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">INFO (EXAMEN)</label>
                        <input type="number" class="grade-input" id="s2_cs_exam" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">TP CHIMIE</label>
                        <input type="number" class="grade-input" id="s2_tp_chem" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">TP PHYSIC</label>
                        <input type="number" class="grade-input" id="s2_tp_phys" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">MST</label>
                        <input type="number" class="grade-input" id="s2_mst" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group" id="s2FrenchGroup">
                        <label class="input-label">français</label>
                        <input type="number" class="grade-input" id="s2_french" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group">
                        <label class="input-label">METHODOLOGY</label>
                        <input type="number" class="grade-input" id="s2_methodology" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                    <div class="grade-input-group" id="s2EnglishGroup">
                        <label class="input-label">ENGLISH</label>
                        <input type="number" class="grade-input" id="s2_english" min="0" max="20" step="0.25" placeholder="0.00">
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="calculateS2Average()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <path d="M9 9h6v6H9z"></path>
                    </svg>
                    حساب المعدل
                </button>
            </form>
            
            <div class="result-container">
                <div class="main-result">
                    <div class="result-value" id="s2ResultValue">--</div>
                    <div class="result-label">معدل الفصل الثاني</div>
                </div>
                <div class="results-table" id="s2ResultsTable">
                    <div class="table-header">
                        <div>Average</div>
                        <div>الرصيد</div>
                        <div>Coef</div>
                        <div>Module</div>
                    </div>
                    <div id="s2TableContent"></div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-success" onclick="saveData('s2')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17,21 17,13 7,13 7,21"></polyline>
                        <polyline points="7,3 7,8 15,8"></polyline>
                    </svg>
                    حفظ النقاط
                </button>
                <button class="btn btn-danger" onclick="resetData('s2')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="1,4 1,10 7,10"></polyline>
                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                    </svg>
                    إعادة تعيين
                </button>
            </div>
        </div>

        <!-- Year Calculator -->
        <div id="yearContainer" class="calculator-container">
            <h2 class="section-title">حساب معدل السنة الكاملة</h2>
            
            <div class="year-summary">
                <div class="summary-card">
                    <div class="summary-title">معدل الفصل الأول (S1)</div>
                    <div class="summary-value" id="yearS1Average">--</div>
                    <div class="summary-title">الرصيد المكتسب</div>
                    <div class="summary-value" id="yearS1Credits">--</div>
                </div>
                <div class="summary-card">
                    <div class="summary-title">معدل الفصل الثاني (S2)</div>
                    <div class="summary-value" id="yearS2Average">--</div>
                    <div class="summary-title">الرصيد المكتسب</div>
                    <div class="summary-value" id="yearS2Credits">--</div>
                </div>
            </div>

            <button type="button" class="btn btn-primary" onclick="calculateYearAverage()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3v18h18"></path>
                    <path d="M8 17l4-4 4 4"></path>
                    <path d="M12 13V7"></path>
                </svg>
                حساب معدل السنة
            </button>
            
            <div class="result-container">
                <div class="main-result">
                    <div class="result-value" id="yearResultValue">--</div>
                    <div class="result-label">معدل السنة الكاملة</div>
                </div>
                <div class="results-table" id="yearResultsTable">
                    <div class="table-header">
                        <div>الحالة</div>
                        <div>الرصيد</div>
                        <div>المعدل</div>
                        <div>الفصل</div>
                    </div>
                    <div id="yearTableContent"></div>
                </div>
            </div>
        </div>

        <!-- Unit Calculator -->
        <div id="unitContainer" class="calculator-container">
            <h2 class="section-title">حساب معدل الوحدات الدراسية</h2>
            
            <!-- Unit Selector -->
            <div class="unit-selector">
                <div class="unit-option active" data-unit="fundamental">
                    <div class="unit-title">الوحدة الأساسية</div>
                    <div class="unit-description">UEF - Unité d'Enseignement Fondamentale</div>
                </div>
                <div class="unit-option" data-unit="methodology">
                    <div class="unit-title">الوحدة المنهجية</div>
                    <div class="unit-description">UEM - Unité d'Enseignement Méthodologique</div>
                </div>
                <div class="unit-option" data-unit="discovery">
                    <div class="unit-title">الوحدة الاستكشافية</div>
                    <div class="unit-description">UED - Unité d'Enseignement Découverte</div>
                </div>
                <div class="unit-option" data-unit="transversal">
                    <div class="unit-title">الوحدة الأفقية</div>
                    <div class="unit-description">UET - Unité d'Enseignement Transversale</div>
                </div>
            </div>

            <!-- Fundamental Unit Form -->
            <form id="fundamentalForm" class="unit-form active">
                <div class="subject-group">
                    <div class="subject-title">الرياضيات (معامل 3)</div>
                    <div class="subject-inputs">
                        <div class="input-group">
                            <label>TD</label>
                            <input type="number" id="fund_math_td" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                        <div class="input-group">
                            <label>Exam</label>
                            <input type="number" id="fund_math_exam" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <div class="subject-group">
                    <div class="subject-title">الفيزياء (معامل 3)</div>
                    <div class="subject-inputs">
                        <div class="input-group">
                            <label>TD</label>
                            <input type="number" id="fund_phys_td" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                        <div class="input-group">
                            <label>Exam</label>
                            <input type="number" id="fund_phys_exam" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <div class="subject-group">
                    <div class="subject-title">الكيمياء (معامل 3)</div>
                    <div class="subject-inputs">
                        <div class="input-group">
                            <label>TD</label>
                            <input type="number" id="fund_chem_td" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                        <div class="input-group">
                            <label>Exam</label>
                            <input type="number" id="fund_chem_exam" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="calculateUnitAverage('fundamental')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                    </svg>
                    حساب معدل الوحدة الأساسية
                </button>
            </form>

            <!-- Methodology Unit Form -->
            <form id="methodologyForm" class="unit-form">
                <div class="subject-group">
                    <div class="subject-title">TP الفيزياء (معامل 1)</div>
                    <div class="subject-inputs single">
                        <div class="input-group">
                            <label>النقطة</label>
                            <input type="number" id="meth_tp_phys" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <div class="subject-group">
                    <div class="subject-title">TP الكيمياء (معامل 1)</div>
                    <div class="subject-inputs single">
                        <div class="input-group">
                            <label>النقطة</label>
                            <input type="number" id="meth_tp_chem" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <div class="subject-group">
                    <div class="subject-title">الإعلام الآلي (معامل 2)</div>
                    <div class="subject-inputs">
                        <div class="input-group">
                            <label>TP</label>
                            <input type="number" id="meth_info_tp" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                        <div class="input-group">
                            <label>Exam</label>
                            <input type="number" id="meth_info_exam" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <div class="subject-group">
                    <div class="subject-title">المنهجية (معامل 1)</div>
                    <div class="subject-inputs single">
                        <div class="input-group">
                            <label>النقطة</label>
                            <input type="number" id="meth_methodology" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="calculateUnitAverage('methodology')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                    </svg>
                    حساب معدل الوحدة المنهجية
                </button>
            </form>

            <!-- Discovery Unit Form -->
            <form id="discoveryForm" class="unit-form">
                <div class="subject-group">
                    <div class="subject-title">MST (معامل 1)</div>
                    <div class="subject-inputs single">
                        <div class="input-group">
                            <label>النقطة</label>
                            <input type="number" id="disc_mst" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="calculateUnitAverage('discovery')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                    </svg>
                    حساب معدل الوحدة الاستكشافية
                </button>
            </form>

            <!-- Transversal Unit Form -->
            <form id="transversalForm" class="unit-form">
                <!-- Language Options for Units -->
                <div class="language-options">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary);">خيارات اللغات الأجنبية:</h3>
                    
                    <div class="language-option">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox">
                                <input type="radio" name="unitLanguageOption" id="unitBothLanguagesRadio" value="both" checked>
                                <div class="checkmark"></div>
                            </div>
                            <label for="unitBothLanguagesRadio">أدرس لغتين أجنبيتين (إنجليزية + فرنسية) - معامل 1 لكل لغة</label>
                        </div>
                    </div>
                    
                    <div class="language-option">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox">
                                <input type="radio" name="unitLanguageOption" id="unitEnglishOnlyRadio" value="english">
                                <div class="checkmark"></div>
                            </div>
                            <label for="unitEnglishOnlyRadio">أدرس الإنجليزية فقط - معامل 2</label>
                        </div>
                    </div>
                    
                    <div class="language-option">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox">
                                <input type="radio" name="unitLanguageOption" id="unitFrenchOnlyRadio" value="french">
                                <div class="checkmark"></div>
                            </div>
                            <label for="unitFrenchOnlyRadio">أدرس الفرنسية فقط - معامل 2</label>
                        </div>
                    </div>
                </div>

                <div class="subject-group" id="unitEnglishGroup">
                    <div class="subject-title">الإنجليزية</div>
                    <div class="subject-inputs single">
                        <div class="input-group">
                            <label>النقطة</label>
                            <input type="number" id="trans_english" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <div class="subject-group" id="unitFrenchGroup">
                    <div class="subject-title">الفرنسية (ethics)</div>
                    <div class="subject-inputs single">
                        <div class="input-group">
                            <label>النقطة</label>
                            <input type="number" id="trans_french" min="0" max="20" step="0.25" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="calculateUnitAverage('transversal')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                    </svg>
                    حساب معدل الوحدة الأفقية
                </button>
            </form>
            
            <div class="result-container">
                <div class="main-result">
                    <div class="result-value" id="unitResultValue">--</div>
                    <div class="result-label" id="unitResultLabel">معدل الوحدة</div>
                </div>
                
                <!-- Unit calculation details -->
                <div class="unit-result-details" id="unitResultDetails">
                    <div id="unitCalculationDetails"></div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-success" onclick="saveUnitData()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17,21 17,13 7,13 7,21"></polyline>
                        <polyline points="7,3 7,8 15,8"></polyline>
                    </svg>
                    حفظ النقاط
                </button>
                <button class="btn btn-danger" onclick="resetUnitData()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="1,4 1,10 7,10"></polyline>
                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                    </svg>
                    إعادة تعيين
                </button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>made by <a href="https://t.me/rewx_x" target="_blank">@rewx_x</a></p>
    </footer>

    <script>
        // Global Variables
        let s1Average = 0;
        let s2Average = 0;
        let s1Credits = 0;
        let s2Credits = 0;
        let yearAverage = 0;
        let currentUnit = 'fundamental';

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            setupNavigation();
            setupThemeToggle();
            setupUnitSelector();
            setupLanguageOptions();
            setupUnitLanguageOptions();
            loadSavedData();
            setupAnimations();
        });

        // Navigation Setup
        function setupNavigation() {
            const navTabs = document.querySelectorAll('.nav-tab');
            const containers = document.querySelectorAll('.calculator-container');

            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    
                    // Remove active class from all tabs and containers
                    navTabs.forEach(t => t.classList.remove('active'));
                    containers.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and target container
                    this.classList.add('active');
                    document.getElementById(targetId).classList.add('active');
                    
                    // Update year summary if year tab is selected
                    if (targetId === 'yearContainer') {
                        updateYearSummary();
                    }
                });
            });
        }

        // Unit Selector Setup
        function setupUnitSelector() {
            const unitOptions = document.querySelectorAll('.unit-option');
            const unitForms = document.querySelectorAll('.unit-form');

            unitOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const unitType = this.getAttribute('data-unit');
                    
                    // Remove active class from all options and forms
                    unitOptions.forEach(opt => opt.classList.remove('active'));
                    unitForms.forEach(form => form.classList.remove('active'));
                    
                    // Add active class to clicked option and corresponding form
                    this.classList.add('active');
                    document.getElementById(unitType + 'Form').classList.add('active');
                    
                    currentUnit = unitType;
                    
                    // Reset result display
                    document.getElementById('unitResultValue').textContent = '--';
                    document.getElementById('unitResultValue').className = 'result-value';
                    document.getElementById('unitResultDetails').classList.remove('show');
                });
            });
        }

        // Language Options Setup for S2
        function setupLanguageOptions() {
            const languageRadios = document.querySelectorAll('input[name="languageOption"]');
            
            languageRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    updateS2LanguageFields(this.value);
                    // Save the selected language option
                    localStorage.setItem('languageOption', this.value);
                });
            });
        }

        // Update S2 Language Fields
        function updateS2LanguageFields(option) {
            const englishGroup = document.getElementById('s2EnglishGroup');
            const frenchGroup = document.getElementById('s2FrenchGroup');
            const englishInput = document.getElementById('s2_english');
            const frenchInput = document.getElementById('s2_french');

            switch(option) {
                case 'english':
                    // Show English only, hide French
                    englishGroup.classList.remove('hidden');
                    frenchGroup.classList.add('hidden');
                    englishInput.disabled = false;
                    frenchInput.disabled = true;
                    frenchInput.value = '';
                    break;
                case 'french':
                    // Show French only, hide English
                    frenchGroup.classList.remove('hidden');
                    englishGroup.classList.add('hidden');
                    frenchInput.disabled = false;
                    englishInput.disabled = true;
                    englishInput.value = '';
                    break;
                case 'both':
                default:
                    // Show both languages
                    englishGroup.classList.remove('hidden');
                    frenchGroup.classList.remove('hidden');
                    englishInput.disabled = false;
                    frenchInput.disabled = false;
                    break;
            }
        }

        // Language Options Setup for Units
        function setupUnitLanguageOptions() {
            const unitLanguageRadios = document.querySelectorAll('input[name="unitLanguageOption"]');
            
            unitLanguageRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    updateUnitLanguageFields(this.value);
                    // Save the selected unit language option
                    localStorage.setItem('unitLanguageOption', this.value);
                });
            });
        }

        // Update Unit Language Fields
        function updateUnitLanguageFields(option) {
            const englishGroup = document.getElementById('unitEnglishGroup');
            const frenchGroup = document.getElementById('unitFrenchGroup');
            const englishInput = document.getElementById('trans_english');
            const frenchInput = document.getElementById('trans_french');

            switch(option) {
                case 'english':
                    // Show English only, hide French
                    englishGroup.classList.remove('disabled');
                    frenchGroup.classList.add('disabled');
                    englishInput.disabled = false;
                    frenchInput.disabled = true;
                    frenchInput.value = '';
                    break;
                case 'french':
                    // Show French only, hide English
                    frenchGroup.classList.remove('disabled');
                    englishGroup.classList.add('disabled');
                    frenchInput.disabled = false;
                    englishInput.disabled = true;
                    englishInput.value = '';
                    break;
                case 'both':
                default:
                    // Show both languages
                    englishGroup.classList.remove('disabled');
                    frenchGroup.classList.remove('disabled');
                    englishInput.disabled = false;
                    frenchInput.disabled = false;
                    break;
            }
        }

        // Theme Toggle Setup
        function setupThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const sunIcon = themeToggle.querySelector('.sun-icon');
            const moonIcon = themeToggle.querySelector('.moon-icon');

            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('light-mode');
                
                if (document.body.classList.contains('light-mode')) {
                    sunIcon.style.display = 'none';
                    moonIcon.style.display = 'block';
                    localStorage.setItem('theme', 'light');
                } else {
                    sunIcon.style.display = 'block';
                    moonIcon.style.display = 'none';
                    localStorage.setItem('theme', 'dark');
                }
            });

            // Load saved theme
            if (localStorage.getItem('theme') === 'light') {
                document.body.classList.add('light-mode');
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            }
        }

        // Load Saved Data
        function loadSavedData() {
            // Load S1 data
            const s1Inputs = document.querySelectorAll('#s1Form input');
            s1Inputs.forEach(input => {
                const savedValue = localStorage.getItem(input.id);
                if (savedValue !== null) {
                    input.value = savedValue;
                }
            });

            // Load S2 data
            const s2Inputs = document.querySelectorAll('#s2Form input');
            s2Inputs.forEach(input => {
                const savedValue = localStorage.getItem(input.id);
                if (savedValue !== null) {
                    input.value = savedValue;
                }
            });

            // Load unit data
            const unitInputs = document.querySelectorAll('.unit-form input');
            unitInputs.forEach(input => {
                const savedValue = localStorage.getItem(input.id);
                if (savedValue !== null) {
                    input.value = savedValue;
                }
            });

            // Load language option for S2
            const savedLanguageOption = localStorage.getItem('languageOption') || 'both';
            const languageRadio = document.querySelector(`input[name="languageOption"][value="${savedLanguageOption}"]`);
            if (languageRadio) {
                languageRadio.checked = true;
                updateS2LanguageFields(savedLanguageOption);
            }

            // Load unit language option
            const savedUnitLanguageOption = localStorage.getItem('unitLanguageOption') || 'both';
            const unitLanguageRadio = document.querySelector(`input[name="unitLanguageOption"][value="${savedUnitLanguageOption}"]`);
            if (unitLanguageRadio) {
                unitLanguageRadio.checked = true;
                updateUnitLanguageFields(savedUnitLanguageOption);
            }

            updateYearSummary();
        }

        // Calculate S1 Average
        function calculateS1Average() {
            const getValue = (id) => parseFloat(document.getElementById(id).value) || 0;

            const modules = {
                math: {
                    name: "Mathématique 1",
                    average: getValue("s1_math_td") * 0.4 + getValue("s1_math_exam") * 0.6,
                    coef: 3,
                    credit: 6
                },
                phys: {
                    name: "Physique 1",
                    average: getValue("s1_phys_td") * 0.4 + getValue("s1_phys_exam") * 0.6,
                    coef: 3,
                    credit: 6
                },
                chem: {
                    name: "Structure de la matière",
                    average: getValue("s1_chem_td") * 0.4 + getValue("s1_chem_exam") * 0.6,
                    coef: 3,
                    credit: 6
                },
                cs: {
                    name: "Informatique 1",
                    average: getValue("s1_cs_tp") * 0.4 + getValue("s1_cs_exam") * 0.6,
                    coef: 2,
                    credit: 4
                },
                tp_chem: {
                    name: "TP Chimie 1",
                    average: getValue("s1_tp_chem"),
                    coef: 1,
                    credit: 2
                },
                tp_phys: {
                    name: "TP Physique 1",
                    average: getValue("s1_tp_phys"),
                    coef: 1,
                    credit: 2
                },
                mst: {
                    name: "Les métiers en sciences et Technologies 1",
                    average: getValue("s1_mst"),
                    coef: 1,
                    credit: 1
                },
                methodology: {
                    name: "Méthodologie de la rédaction",
                    average: getValue("s1_methodology"),
                    coef: 1,
                    credit: 1
                },
                english: {
                    name: "Langue Anglaise 1",
                    average: getValue("s1_english"),
                    coef: 1,
                    credit: 1
                },
                ethics: {
                    name: "Dimension éthique et déontologique",
                    average: getValue("s1_ethics"),
                    coef: 1,
                    credit: 1
                }
            };

            let totalPoints = 0;
            let totalCoef = 0;
            let totalCredits = 0;
            let acquiredCredits = 0;

            for (let module in modules) {
                totalPoints += modules[module].average * modules[module].coef;
                totalCoef += modules[module].coef;
                totalCredits += modules[module].credit;
            }

            s1Average = totalPoints / totalCoef;

            // Calculate acquired credits - NEW LOGIC
            if (s1Average >= 10) {
                // If semester average >= 10, get all credits (30)
                acquiredCredits = totalCredits;
            } else {
                // If semester average < 10, only get credits for modules with >= 10
                for (let module in modules) {
                    if (modules[module].average >= 10) {
                        acquiredCredits += modules[module].credit;
                    }
                }
            }

            s1Credits = acquiredCredits;

            // Update result display
            const resultValue = document.getElementById("s1ResultValue");
            const colorClass = s1Average < 10 ? 'text-danger' : s1Average < 12 ? 'text-warning' : 'text-success';
            resultValue.className = `result-value ${colorClass}`;
            resultValue.textContent = s1Average.toFixed(2);

            // Show detailed results
            const resultsTable = document.getElementById("s1ResultsTable");
            const tableContent = document.getElementById("s1TableContent");
            resultsTable.style.display = "block";

            tableContent.innerHTML = `
                <div class="table-row semester-row">
                    <div class="table-value ${colorClass}">${s1Average.toFixed(2)}</div>
                    <div class="table-value">${acquiredCredits}</div>
                    <div class="table-value">${totalCoef}</div>
                    <div class="module-name" style="color: var(--primary-color); font-weight: 600;">Semester Grade</div>
                </div>
            `;

            // Add each module
            for (let module in modules) {
                // For individual modules, show credit only if module >= 10 OR semester >= 10
                const moduleAcquiredCredits = (modules[module].average >= 10 || s1Average >= 10) ? modules[module].credit : 0;
                const moduleColorClass = modules[module].average >= 10 ? 'text-success' : 'text-danger';
                
                tableContent.innerHTML += `
                    <div class="table-row">
                        <div class="table-value ${moduleColorClass}">${modules[module].average.toFixed(2)}</div>
                        <div class="table-value">${moduleAcquiredCredits}</div>
                        <div class="table-value">${modules[module].coef}</div>
                        <div class="module-name">${modules[module].name}</div>
                    </div>
                `;
            }

            // Save results
            localStorage.setItem('s1Average', s1Average);
            localStorage.setItem('s1Credits', s1Credits);
            updateYearSummary();
            showNotification('تم حساب معدل الفصل الأول بنجاح!');
        }

        // Calculate S2 Average - FIXED VERSION
        function calculateS2Average() {
            const getValue = (id) => parseFloat(document.getElementById(id).value) || 0;

            // Get selected language option
            const languageOption = document.querySelector('input[name="languageOption"]:checked').value;
            
            let frenchValue = getValue("s2_french");
            let englishValue = getValue("s2_english");
            let frenchCoef = 1;
            let englishCoef = 1;

            // Adjust coefficients based on language option
            if (languageOption === 'english') {
                // English only with coefficient 2
                englishCoef = 2;
                frenchValue = 0; // Don't count French
                frenchCoef = 0;
            } else if (languageOption === 'french') {
                // French only with coefficient 2
                frenchCoef = 2;
                englishValue = 0; // Don't count English
                englishCoef = 0;
            }
            // If 'both', keep default coefficients of 1 each

            const modules = {
                math: {
                    name: "Mathématique 2",
                    average: getValue("s2_math_td") * 0.4 + getValue("s2_math_exam") * 0.6,
                    coef: 3,
                    credit: 6
                },
                phys: {
                    name: "Physique 2",
                    average: getValue("s2_phys_td") * 0.4 + getValue("s2_phys_exam") * 0.6,
                    coef: 3,
                    credit: 6
                },
                chem: {
                    name: "Thermodynamique chimique",
                    average: getValue("s2_chem_td") * 0.4 + getValue("s2_chem_exam") * 0.6,
                    coef: 3,
                    credit: 6
                },
                cs: {
                    name: "Informatique 2",
                    average: getValue("s2_cs_tp") * 0.4 + getValue("s2_cs_exam") * 0.6,
                    coef: 2,
                    credit: 4
                },
                tp_chem: {
                    name: "TP Chimie 2",
                    average: getValue("s2_tp_chem"),
                    coef: 1,
                    credit: 2
                },
                tp_phys: {
                    name: "TP Physique 2",
                    average: getValue("s2_tp_phys"),
                    coef: 1,
                    credit: 2
                },
                mst: {
                    name: "Les métiers en sciences et Technologies 2",
                    average: getValue("s2_mst"),
                    coef: 1,
                    credit: 1
                },
                methodology: {
                    name: "Méthodologie de la présentation",
                    average: getValue("s2_methodology"),
                    coef: 1,
                    credit: 1
                }
            };

            // Add language modules based on selection
            if (languageOption === 'both') {
                modules.french = {
                    name: "Langue française",
                    average: frenchValue,
                    coef: frenchCoef,
                    credit: 1
                };
                modules.english = {
                    name: "Langue Anglaise 2",
                    average: englishValue,
                    coef: englishCoef,
                    credit: 1
                };
            } else if (languageOption === 'english') {
                modules.english = {
                    name: "Langue Anglaise 2",
                    average: englishValue,
                    coef: englishCoef,
                    credit: 2
                };
            } else if (languageOption === 'french') {
                modules.french = {
                    name: "Langue française",
                    average: frenchValue,
                    coef: frenchCoef,
                    credit: 2
                };
            }

            let totalPoints = 0;
            let totalCoef = 0;
            let totalCredits = 0;
            let acquiredCredits = 0;

            for (let module in modules) {
                totalPoints += modules[module].average * modules[module].coef;
                totalCoef += modules[module].coef;
                totalCredits += modules[module].credit;
            }

            s2Average = totalPoints / totalCoef;

            // Calculate acquired credits - NEW LOGIC
            if (s2Average >= 10) {
                // If semester average >= 10, get all credits (30)
                acquiredCredits = totalCredits;
            } else {
                // If semester average < 10, only get credits for modules with >= 10
                for (let module in modules) {
                    if (modules[module].average >= 10) {
                        acquiredCredits += modules[module].credit;
                    }
                }
            }

            s2Credits = acquiredCredits;

            // Update result display
            const resultValue = document.getElementById("s2ResultValue");
            const colorClass = s2Average < 10 ? 'text-danger' : s2Average < 12 ? 'text-warning' : 'text-success';
            resultValue.className = `result-value ${colorClass}`;
            resultValue.textContent = s2Average.toFixed(2);

            // Show detailed results
            const resultsTable = document.getElementById("s2ResultsTable");
            const tableContent = document.getElementById("s2TableContent");
            resultsTable.style.display = "block";

            tableContent.innerHTML = `
                <div class="table-row semester-row">
                    <div class="table-value ${colorClass}">${s2Average.toFixed(2)}</div>
                    <div class="table-value">${acquiredCredits}</div>
                    <div class="table-value">${totalCoef}</div>
                    <div class="module-name" style="color: var(--primary-color); font-weight: 600;">Semester Grade</div>
                </div>
            `;

            // Add each module
            for (let module in modules) {
                // For individual modules, show credit only if module >= 10 OR semester >= 10
                const moduleAcquiredCredits = (modules[module].average >= 10 || s2Average >= 10) ? modules[module].credit : 0;
                const moduleColorClass = modules[module].average >= 10 ? 'text-success' : 'text-danger';
                
                tableContent.innerHTML += `
                    <div class="table-row">
                        <div class="table-value ${moduleColorClass}">${modules[module].average.toFixed(2)}</div>
                        <div class="table-value">${moduleAcquiredCredits}</div>
                        <div class="table-value">${modules[module].coef}</div>
                        <div class="module-name">${modules[module].name}</div>
                    </div>
                `;
            }

            // Save results
            localStorage.setItem('s2Average', s2Average);
            localStorage.setItem('s2Credits', s2Credits);
            updateYearSummary();
            showNotification('تم حساب معدل الفصل الثاني بنجاح!');
        }

        // Calculate Year Average
        function calculateYearAverage() {
            // Get saved averages
            s1Average = parseFloat(localStorage.getItem('s1Average')) || 0;
            s2Average = parseFloat(localStorage.getItem('s2Average')) || 0;
            s1Credits = parseFloat(localStorage.getItem('s1Credits')) || 0;
            s2Credits = parseFloat(localStorage.getItem('s2Credits')) || 0;

            // Calculate year average and total credits
            yearAverage = (s1Average + s2Average) / 2;
            const totalYearCredits = s1Credits + s2Credits;

            // Update result display
            const resultValue = document.getElementById("yearResultValue");
            const colorClass = yearAverage < 10 ? 'text-danger' : yearAverage < 12 ? 'text-warning' : 'text-success';
            resultValue.className = `result-value ${colorClass}`;
            resultValue.textContent = yearAverage.toFixed(2);

            // Show detailed results
            const resultsTable = document.getElementById("yearResultsTable");
            const tableContent = document.getElementById("yearTableContent");
            resultsTable.style.display = "block";

            tableContent.innerHTML = `
                <div class="table-row">
                    <div class="table-value ${s1Average >= 10 ? 'text-success' : 'text-danger'}">
                        ${s1Average >= 10 ? 'ناجح' : 'راسب'}
                    </div>
                    <div class="table-value">${s1Credits}</div>
                    <div class="table-value ${s1Average < 10 ? 'text-danger' : s1Average < 12 ? 'text-warning' : 'text-success'}">
                        ${s1Average.toFixed(2)}
                    </div>
                    <div class="module-name">الفصل الأول (S1)</div>
                </div>
                <div class="table-row">
                    <div class="table-value ${s2Average >= 10 ? 'text-success' : 'text-danger'}">
                        ${s2Average >= 10 ? 'ناجح' : 'راسب'}
                    </div>
                    <div class="table-value">${s2Credits}</div>
                    <div class="table-value ${s2Average < 10 ? 'text-danger' : s2Average < 12 ? 'text-warning' : 'text-success'}">
                        ${s2Average.toFixed(2)}
                    </div>
                    <div class="module-name">الفصل الثاني (S2)</div>
                </div>
                <div class="table-row semester-row">
                    <div class="table-value ${yearAverage >= 10 ? 'text-success' : 'text-danger'}">
                        ${yearAverage >= 10 ? 'ناجح' : 'راسب'}
                    </div>
                    <div class="table-value">${Math.round(totalYearCredits)}</div>
                    <div class="table-value ${colorClass}">${yearAverage.toFixed(2)}</div>
                    <div class="module-name" style="color: var(--primary-color); font-weight: 600;">معدل السنة</div>
                </div>
            `;

            showNotification('تم حساب معدل السنة بنجاح!');
        }

        // Calculate Unit Average - UPDATED WITH LANGUAGE OPTIONS
        function calculateUnitAverage(unitType) {
            const getValue = (id) => parseFloat(document.getElementById(id).value) || 0;
            let unitAverage = 0;
            let unitName = '';
            let totalCoefficients = 0;
            let weightedSum = 0;
            let calculationDetails = '';
            let modules = [];
            let acquiredCredits = 0;
            let totalCredits = 0;

            switch(unitType) {
                case 'fundamental':
                    // Calculate individual subject averages first
                    const mathAvg = getValue("fund_math_td") * 0.4 + getValue("fund_math_exam") * 0.6;
                    const physAvg = getValue("fund_phys_td") * 0.4 + getValue("fund_phys_exam") * 0.6;
                    const chemAvg = getValue("fund_chem_td") * 0.4 + getValue("fund_chem_exam") * 0.6;
                    
                    modules = [
                        { name: 'الرياضيات', grade: mathAvg, coef: 3, credit: 6 },
                        { name: 'الفيزياء', grade: physAvg, coef: 3, credit: 6 },
                        { name: 'الكيمياء', grade: chemAvg, coef: 3, credit: 6 }
                    ];
                    
                    totalCoefficients = 3 + 3 + 3; // 9
                    weightedSum = (mathAvg * 3) + (physAvg * 3) + (chemAvg * 3);
                    unitAverage = weightedSum / totalCoefficients;
                    unitName = 'الوحدة الأساسية';
                    totalCredits = 18;
                    break;
                    
                case 'methodology':
                    const tpPhys = getValue("meth_tp_phys");
                    const tpChem = getValue("meth_tp_chem");
                    const infoAvg = getValue("meth_info_tp") * 0.4 + getValue("meth_info_exam") * 0.6;
                    const methodology = getValue("meth_methodology");
                    
                    modules = [
                        { name: 'TP الفيزياء', grade: tpPhys, coef: 1, credit: 2 },
                        { name: 'TP الكيمياء', grade: tpChem, coef: 1, credit: 2 },
                        { name: 'الإعلام الآلي', grade: infoAvg, coef: 2, credit: 4 },
                        { name: 'المنهجية', grade: methodology, coef: 1, credit: 1 }
                    ];
                    
                    totalCoefficients = 1 + 1 + 2 + 1; // 5
                    weightedSum = (tpPhys * 1) + (tpChem * 1) + (infoAvg * 2) + (methodology * 1);
                    unitAverage = weightedSum / totalCoefficients;
                    unitName = 'الوحدة المنهجية';
                    totalCredits = 9;
                    break;
                    
                case 'discovery':
                    const mst = getValue("disc_mst");

                    modules = [
                        { name: 'MST', grade: mst, coef: 1, credit: 1 }
                    ];

                    totalCoefficients = 1;
                    weightedSum = mst;
                    unitAverage = weightedSum / totalCoefficients;
                    unitName = 'الوحدة الاستكشافية';
                    totalCredits = 1;
                    break;
                      
                case 'transversal':
                    // Get selected unit language option
                    const unitLanguageOption = document.querySelector('input[name="unitLanguageOption"]:checked').value;
                    
                    const english = getValue("trans_english");
                    const french = getValue("trans_french");

                    modules = [];
                    totalCoefficients = 0;
                    weightedSum = 0;
                    totalCredits = 0;

                    if (unitLanguageOption === 'both') {
                        modules = [
                            { name: 'الإنجليزية', grade: english, coef: 1, credit: 1 },
                            { name: 'الفرنسية (ethics)', grade: french, coef: 1, credit: 1 }
                        ];
                        totalCoefficients = 2;
                        weightedSum = english + french;
                        totalCredits = 2;
                    } else if (unitLanguageOption === 'english') {
                        modules = [
                            { name: 'الإنجليزية', grade: english, coef: 2, credit: 2 }
                        ];
                        totalCoefficients = 2;
                        weightedSum = english * 2;
                        totalCredits = 2;
                    } else if (unitLanguageOption === 'french') {
                        modules = [
                            { name: 'الفرنسية (ethics)', grade: french, coef: 2, credit: 2 }
                        ];
                        totalCoefficients = 2;
                        weightedSum = french * 2;
                        totalCredits = 2;
                    }

                    unitAverage = weightedSum / totalCoefficients;
                    unitName = 'الوحدة الأفقية';
                    break;
            }

            // Calculate acquired credits based on unit logic
            if (unitAverage >= 10) {
                // Unit is acquired, get all credits
                acquiredCredits = totalCredits;
            } else {
                // Unit not acquired, get credits only for individual modules >= 10
                for (let module of modules) {
                    if (module.grade >= 10) {
                        acquiredCredits += module.credit;
                    }
                }
            }

            // Create calculation details
            calculationDetails = `
                <div class="unit-detail-row">
                    <span class="unit-detail-label">تفاصيل المواد:</span>
                    <span class="unit-detail-value"></span>
                </div>
            `;

            // Add each module details
            for (let module of modules) {
                const moduleColorClass = module.grade >= 10 ? 'text-success' : 'text-danger';
                calculationDetails += `
                    <div class="unit-detail-row">
                        <span class="unit-detail-label">${module.name}:</span>
                        <span class="unit-detail-value ${moduleColorClass}">${module.grade.toFixed(2)} × ${module.coef}</span>
                    </div>
                `;
            }

            calculationDetails += `
                <div class="unit-detail-row">
                    <span class="unit-detail-label">مجموع المعاملات:</span>
                    <span class="unit-detail-value">${totalCoefficients}</span>
                </div>
                <div class="unit-detail-row">
                    <span class="unit-detail-label">مجموع (النقطة × المعامل):</span>
                    <span class="unit-detail-value">${weightedSum.toFixed(2)}</span>
                </div>
                <div class="unit-detail-row">
                    <span class="unit-detail-label">الحساب:</span>
                    <span class="unit-detail-value">${weightedSum.toFixed(2)} ÷ ${totalCoefficients}</span>
                </div>
                <div class="unit-detail-row">
                    <span class="unit-detail-label">الحالة:</span>
                    <span class="unit-detail-value ${unitAverage >= 10 ? 'text-success' : 'text-danger'}">
                        ${unitAverage >= 10 ? 'مكتسبة' : 'غير مكتسبة'}
                    </span>
                </div>
                <div class="unit-detail-row">
                    <span class="unit-detail-label">الأرصدة المكتسبة:</span>
                    <span class="unit-detail-value">${acquiredCredits} من ${totalCredits}</span>
                </div>
            `;

            // Update result display
            const resultValue = document.getElementById("unitResultValue");
            const resultLabel = document.getElementById("unitResultLabel");
            const colorClass = unitAverage < 10 ? 'text-danger' : unitAverage < 12 ? 'text-warning' : 'text-success';
            
            resultValue.className = `result-value ${colorClass}`;
            resultValue.textContent = unitAverage.toFixed(2);
            resultLabel.textContent = `معدل ${unitName}`;

            // Show calculation details
            const detailsContainer = document.getElementById('unitResultDetails');
            const detailsContent = document.getElementById('unitCalculationDetails');
            detailsContent.innerHTML = calculationDetails;
            detailsContainer.classList.add('show');

            showNotification(`تم حساب معدل ${unitName} بنجاح!`);
        }

        // Update Year Summary
        function updateYearSummary() {
            s1Average = parseFloat(localStorage.getItem('s1Average')) || 0;
            s2Average = parseFloat(localStorage.getItem('s2Average')) || 0;
            s1Credits = parseFloat(localStorage.getItem('s1Credits')) || 0;
            s2Credits = parseFloat(localStorage.getItem('s2Credits')) || 0;

            const s1AvgElement = document.getElementById("yearS1Average");
            const s2AvgElement = document.getElementById("yearS2Average");
            const s1CreditsElement = document.getElementById("yearS1Credits");
            const s2CreditsElement = document.getElementById("yearS2Credits");

            const s1ColorClass = s1Average < 10 ? 'text-danger' : s1Average < 12 ? 'text-warning' : 'text-success';
            const s2ColorClass = s2Average < 10 ? 'text-danger' : s2Average < 12 ? 'text-warning' : 'text-success';

            s1AvgElement.className = `summary-value ${s1ColorClass}`;
            s1AvgElement.textContent = s1Average.toFixed(2);
            s2AvgElement.className = `summary-value ${s2ColorClass}`;
            s2AvgElement.textContent = s2Average.toFixed(2);
            
            s1CreditsElement.textContent = s1Credits;
            s2CreditsElement.textContent = s2Credits;
        }

        // Save Data
        function saveData(prefix) {
            const inputs = document.querySelectorAll(`#${prefix}Form input`);
            inputs.forEach(input => {
                localStorage.setItem(input.id, input.value);
            });

            if (prefix === 's2') {
                const languageOption = document.querySelector('input[name="languageOption"]:checked').value;
                localStorage.setItem('languageOption', languageOption);
            }

            showNotification('تم حفظ النقاط بنجاح!');
        }

        // Save Unit Data
        function saveUnitData() {
            const inputs = document.querySelectorAll('.unit-form input');
            inputs.forEach(input => {
                localStorage.setItem(input.id, input.value);
            });

            // Save unit language option
            const unitLanguageOption = document.querySelector('input[name="unitLanguageOption"]:checked').value;
            localStorage.setItem('unitLanguageOption', unitLanguageOption);

            showNotification('تم حفظ نقاط الوحدات بنجاح!');
        }

        // Reset Data
        function resetData(prefix) {
            if (confirm('هل أنت متأكد من رغبتك في إعادة تعيين جميع القيم؟')) {
                const inputs = document.querySelectorAll(`#${prefix}Form input`);
                inputs.forEach(input => {
                    localStorage.removeItem(input.id);
                    input.value = '';
                });

                // Reset result
                const resultValue = document.getElementById(`${prefix}ResultValue`);
                resultValue.textContent = '--';
                resultValue.className = 'result-value';

                const resultsTable = document.getElementById(`${prefix}ResultsTable`);
                if (resultsTable) {
                    resultsTable.style.display = 'none';
                }

                if (prefix === 's2') {
                    document.querySelector('input[name="languageOption"][value="both"]').checked = true;
                    localStorage.removeItem('languageOption');
                    updateS2LanguageFields('both');
                }

                // Reset stored averages and credits
                if (prefix === 's1') {
                    localStorage.removeItem('s1Average');
                    localStorage.removeItem('s1Credits');
                } else if (prefix === 's2') {
                    localStorage.removeItem('s2Average');
                    localStorage.removeItem('s2Credits');
                }

                updateYearSummary();
                showNotification('تم إعادة تعيين جميع القيم بنجاح!');
            }
        }

        // Reset Unit Data
        function resetUnitData() {
            if (confirm('هل أنت متأكد من رغبتك في إعادة تعيين جميع قيم الوحدات؟')) {
                const inputs = document.querySelectorAll('.unit-form input');
                inputs.forEach(input => {
                    localStorage.removeItem(input.id);
                    input.value = '';
                    input.disabled = false; // Re-enable all inputs
                });

                // Reset language option to both
                document.querySelector('input[name="unitLanguageOption"][value="both"]').checked = true;
                localStorage.removeItem('unitLanguageOption');
                updateUnitLanguageFields('both');

                // Reset result
                document.getElementById('unitResultValue').textContent = '--';
                document.getElementById('unitResultValue').className = 'result-value';
                document.getElementById('unitResultLabel').textContent = 'معدل الوحدة';
                document.getElementById('unitResultDetails').classList.remove('show');

                showNotification('تم إعادة تعيين جميع قيم الوحدات بنجاح!');
            }
        }

        // Show Notification
        function showNotification(message) {
            // Remove existing notification
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            // Create new notification
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
                ${message}
            `;
            document.body.appendChild(notification);

            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            // Hide notification after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }

        // Setup Animations
        function setupAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, observerOptions);

            // Observe elements for animation
            const animatedElements = document.querySelectorAll('.calculator-container, .summary-card, .grade-input-group');
            animatedElements.forEach(el => {
                el.classList.add('fade-in');
                observer.observe(el);
            });
        }

        // Auto-save functionality
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('grade-input') || e.target.closest('.unit-form')) {
                const form = e.target.closest('form');
                if (form) {
                    const formId = form.id;
                    if (formId.includes('s1') || formId.includes('s2')) {
                        const prefix = formId.replace('Form', '');
                        
                        // Auto-save after 1 second of no input
                        clearTimeout(window.autoSaveTimeout);
                        window.autoSaveTimeout = setTimeout(() => {
                            saveData(prefix);
                        }, 1000);
                    } else {
                        // Auto-save unit data
                        clearTimeout(window.autoSaveUnitTimeout);
                        window.autoSaveUnitTimeout = setTimeout(() => {
                            saveUnitData();
                        }, 1000);
                    }
                }
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S to save
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                const activeContainer = document.querySelector('.calculator-container.active');
                if (activeContainer) {
                    const containerId = activeContainer.id;
                    if (containerId === 'unitContainer') {
                        saveUnitData();
                    } else {
                        const prefix = containerId.replace('Container', '');
                        saveData(prefix);
                    }
                }
            }
            
            // Ctrl/Cmd + R to reset (with confirmation)
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                const activeContainer = document.querySelector('.calculator-container.active');
                if (activeContainer) {
                    const containerId = activeContainer.id;
                    if (containerId === 'unitContainer') {
                        resetUnitData();
                    } else {
                        const prefix = containerId.replace('Container', '');
                        resetData(prefix);
                    }
                }
            }
        });

        // Add input validation
        document.addEventListener('input', function(e) {
            if (e.target.type === 'number') {
                const value = parseFloat(e.target.value);
                if (value > 20) {
                    e.target.value = 20;
                } else if (value < 0) {
                    e.target.value = 0;
                }
            }
        });
    </script>
</body>
</html>